import{L as x,P as de,bf as ce,b as I,d as g,aX as Y,bS as F,a as L,a3 as ke,u as N,aF as H,S as pe,o as y,a5 as P,v as $,c as C,a6 as Fe,a7 as $e,n as h,e as t,bi as fe,r as S,g as E,h as O,aL as B,s as R,E as T,bT as Re,t as J,i as Se,aS as we,aU as Ce,aV as Ue,bU as Le,bV as Pe,bw as Oe,_ as z,ac as Te,bM as Z,bW as ee,bX as De,aW as je,bY as Be,V as te,aH as Ae,U as j,m as Me,ap as Ne,bH as Ie,bR as se,b4 as ae,w as qe,bZ as He,b_ as ze,b$ as q,x as Ke,y as Ve,f as Xe,z as me}from"./index.5c273e28.js";import{E as We}from"./el-progress.1077d908.js";import{b as Ge}from"./_baseClone.38a63ccd.js";import{o as Ye}from"./isEqual.87dc7c2b.js";var Je=1,Ze=4;function oe(a){return Ge(a,Je|Ze)}const ve=Symbol("uploadContextKey"),Qe="ElUpload";class xe extends Error{constructor(r,e,u,c){super(r),this.name="UploadAjaxError",this.status=e,this.method=u,this.url=c}}function ne(a,r,e){let u;return e.response?u=`${e.response.error||e.response}`:e.responseText?u=`${e.responseText}`:u=`fail to ${r.method} ${a} ${e.status}`,new xe(u,e.status,r.method,a)}function et(a){const r=a.responseText||a.response;if(!r)return r;try{return JSON.parse(r)}catch{return r}}const tt=a=>{typeof XMLHttpRequest>"u"&&x(Qe,"XMLHttpRequest is undefined");const r=new XMLHttpRequest,e=a.action;r.upload&&r.upload.addEventListener("progress",v=>{const f=v;f.percent=v.total>0?v.loaded/v.total*100:0,a.onProgress(f)});const u=new FormData;if(a.data)for(const[v,f]of Object.entries(a.data))de(f)&&f.length?u.append(v,...f):u.append(v,f);u.append(a.filename,a.file,a.file.name),r.addEventListener("error",()=>{a.onError(ne(e,a,r))}),r.addEventListener("load",()=>{if(r.status<200||r.status>=300)return a.onError(ne(e,a,r));a.onSuccess(et(r))}),r.open(a.method,e,!0),a.withCredentials&&"withCredentials"in r&&(r.withCredentials=!0);const c=a.headers||{};if(c instanceof Headers)c.forEach((v,f)=>r.setRequestHeader(f,v));else for(const[v,f]of Object.entries(c))ce(f)||r.setRequestHeader(v,String(f));return r.send(u),r},ge=["text","picture","picture-card"];let st=1;const Q=()=>Date.now()+st++,ye=I({action:{type:String,default:"#"},headers:{type:g(Object)},method:{type:String,default:"post"},data:{type:g([Object,Function,Promise]),default:()=>Y({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:g(Array),default:()=>Y([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:ge,default:"text"},httpRequest:{type:g(Function),default:tt},disabled:Boolean,limit:Number}),at=I({...ye,beforeUpload:{type:g(Function),default:F},beforeRemove:{type:g(Function)},onRemove:{type:g(Function),default:F},onChange:{type:g(Function),default:F},onPreview:{type:g(Function),default:F},onSuccess:{type:g(Function),default:F},onProgress:{type:g(Function),default:F},onError:{type:g(Function),default:F},onExceed:{type:g(Function),default:F}}),ot=I({files:{type:g(Array),default:()=>Y([])},disabled:{type:Boolean,default:!1},handlePreview:{type:g(Function),default:F},listType:{type:String,values:ge,default:"text"}}),nt={remove:a=>!!a},lt=["onKeydown"],rt=["src"],ut=["onClick"],it=["title"],dt=["onClick"],ct=["onClick"],pt=L({name:"ElUploadList"}),ft=L({...pt,props:ot,emits:nt,setup(a,{emit:r}){const{t:e}=ke(),u=N("upload"),c=N("icon"),v=N("list"),f=H(),k=pe(!1),b=p=>{r("remove",p)};return(p,_)=>(y(),P(Oe,{tag:"ul",class:h([t(u).b("list"),t(u).bm("list",p.listType),t(u).is("disabled",t(f))]),name:t(v).b()},{default:$(()=>[(y(!0),C(Fe,null,$e(p.files,m=>(y(),C("li",{key:m.uid||m.name,class:h([t(u).be("list","item"),t(u).is(m.status),{focusing:k.value}]),tabindex:"0",onKeydown:fe(n=>!t(f)&&b(m),["delete"]),onFocus:_[0]||(_[0]=n=>k.value=!0),onBlur:_[1]||(_[1]=n=>k.value=!1),onClick:_[2]||(_[2]=n=>k.value=!1)},[S(p.$slots,"default",{file:m},()=>[p.listType==="picture"||m.status!=="uploading"&&p.listType==="picture-card"?(y(),C("img",{key:0,class:h(t(u).be("list","item-thumbnail")),src:m.url,alt:""},null,10,rt)):E("v-if",!0),m.status==="uploading"||p.listType!=="picture-card"?(y(),C("div",{key:1,class:h(t(u).be("list","item-info"))},[O("a",{class:h(t(u).be("list","item-name")),onClick:B(n=>p.handlePreview(m),["prevent"])},[R(t(T),{class:h(t(c).m("document"))},{default:$(()=>[R(t(Re))]),_:1},8,["class"]),O("span",{class:h(t(u).be("list","item-file-name")),title:m.name},J(m.name),11,it)],10,ut),m.status==="uploading"?(y(),P(t(We),{key:0,type:p.listType==="picture-card"?"circle":"line","stroke-width":p.listType==="picture-card"?6:2,percentage:Number(m.percentage),style:Se(p.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):E("v-if",!0)],2)):E("v-if",!0),O("label",{class:h(t(u).be("list","item-status-label"))},[p.listType==="text"?(y(),P(t(T),{key:0,class:h([t(c).m("upload-success"),t(c).m("circle-check")])},{default:$(()=>[R(t(we))]),_:1},8,["class"])):["picture-card","picture"].includes(p.listType)?(y(),P(t(T),{key:1,class:h([t(c).m("upload-success"),t(c).m("check")])},{default:$(()=>[R(t(Ce))]),_:1},8,["class"])):E("v-if",!0)],2),t(f)?E("v-if",!0):(y(),P(t(T),{key:2,class:h(t(c).m("close")),onClick:n=>b(m)},{default:$(()=>[R(t(Ue))]),_:2},1032,["class","onClick"])),E(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),E(" This is a bug which needs to be fixed "),E(" TODO: Fix the incorrect navigation interaction "),t(f)?E("v-if",!0):(y(),C("i",{key:3,class:h(t(c).m("close-tip"))},J(t(e)("el.upload.deleteTip")),3)),p.listType==="picture-card"?(y(),C("span",{key:4,class:h(t(u).be("list","item-actions"))},[O("span",{class:h(t(u).be("list","item-preview")),onClick:n=>p.handlePreview(m)},[R(t(T),{class:h(t(c).m("zoom-in"))},{default:$(()=>[R(t(Le))]),_:1},8,["class"])],10,dt),t(f)?E("v-if",!0):(y(),C("span",{key:0,class:h(t(u).be("list","item-delete")),onClick:n=>b(m)},[R(t(T),{class:h(t(c).m("delete"))},{default:$(()=>[R(t(Pe))]),_:1},8,["class"])],10,ct))],2)):E("v-if",!0)])],42,lt))),128)),S(p.$slots,"append")]),_:3},8,["class","name"]))}});var le=z(ft,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const mt=I({disabled:{type:Boolean,default:!1}}),vt={file:a=>de(a)},gt=["onDrop","onDragover"],be="ElUploadDrag",yt=L({name:be}),bt=L({...yt,props:mt,emits:vt,setup(a,{emit:r}){const e=Te(ve);e||x(be,"usage: <el-upload><el-upload-dragger /></el-upload>");const u=N("upload"),c=pe(!1),v=H(),f=b=>{if(v.value)return;c.value=!1,b.stopPropagation();const p=Array.from(b.dataTransfer.files),_=e.accept.value;if(!_){r("file",p);return}const m=p.filter(n=>{const{type:o,name:i}=n,s=i.includes(".")?`.${i.split(".").pop()}`:"",d=o.replace(/\/.*$/,"");return _.split(",").map(l=>l.trim()).filter(l=>l).some(l=>l.startsWith(".")?s===l:/\/\*$/.test(l)?d===l.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(l)?o===l:!1)});r("file",m)},k=()=>{v.value||(c.value=!0)};return(b,p)=>(y(),C("div",{class:h([t(u).b("dragger"),t(u).is("dragover",c.value)]),onDrop:B(f,["prevent"]),onDragover:B(k,["prevent"]),onDragleave:p[0]||(p[0]=B(_=>c.value=!1,["prevent"]))},[S(b.$slots,"default")],42,gt))}});var ht=z(bt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const _t=I({...ye,beforeUpload:{type:g(Function),default:F},onRemove:{type:g(Function),default:F},onStart:{type:g(Function),default:F},onSuccess:{type:g(Function),default:F},onProgress:{type:g(Function),default:F},onError:{type:g(Function),default:F},onExceed:{type:g(Function),default:F}}),Et=["onKeydown"],kt=["name","multiple","accept"],Ft=L({name:"ElUploadContent",inheritAttrs:!1}),$t=L({...Ft,props:_t,setup(a,{expose:r}){const e=a,u=N("upload"),c=H(),v=Z({}),f=Z(),k=s=>{if(s.length===0)return;const{autoUpload:d,limit:l,fileList:w,multiple:U,onStart:A,onExceed:K}=e;if(l&&w.length+s.length>l){K(s,w);return}U||(s=s.slice(0,1));for(const V of s){const M=V;M.uid=Q(),A(M),d&&b(M)}},b=async s=>{if(f.value.value="",!e.beforeUpload)return _(s);let d,l={};try{const U=e.data,A=e.beforeUpload(s);l=ee(e.data)?oe(e.data):e.data,d=await A,ee(e.data)&&Ye(U,l)&&(l=oe(e.data))}catch{d=!1}if(d===!1){e.onRemove(s);return}let w=s;d instanceof Blob&&(d instanceof File?w=d:w=new File([d],s.name,{type:s.type})),_(Object.assign(w,{uid:s.uid}),l)},p=async(s,d)=>je(s)?s(d):s,_=async(s,d)=>{const{headers:l,data:w,method:U,withCredentials:A,name:K,action:V,onProgress:M,onSuccess:he,onError:_e,httpRequest:Ee}=e;try{d=await p(d!=null?d:w,s)}catch{e.onRemove(s);return}const{uid:X}=s,W={headers:l||{},withCredentials:A,file:s,data:d,method:U,filename:K,action:V,onProgress:D=>{M(D,s)},onSuccess:D=>{he(D,s),delete v.value[X]},onError:D=>{_e(D,s),delete v.value[X]}},G=Ee(W);v.value[X]=G,G instanceof Promise&&G.then(W.onSuccess,W.onError)},m=s=>{const d=s.target.files;!d||k(Array.from(d))},n=()=>{c.value||(f.value.value="",f.value.click())},o=()=>{n()};return r({abort:s=>{De(v.value).filter(s?([l])=>String(s.uid)===l:()=>!0).forEach(([l,w])=>{w instanceof XMLHttpRequest&&w.abort(),delete v.value[l]})},upload:b}),(s,d)=>(y(),C("div",{class:h([t(u).b(),t(u).m(s.listType),t(u).is("drag",s.drag)]),tabindex:"0",onClick:n,onKeydown:fe(B(o,["self"]),["enter","space"])},[s.drag?(y(),P(ht,{key:0,disabled:t(c),onFile:k},{default:$(()=>[S(s.$slots,"default")]),_:3},8,["disabled"])):S(s.$slots,"default",{key:1}),O("input",{ref_key:"inputRef",ref:f,class:h(t(u).e("input")),name:s.name,multiple:s.multiple,accept:s.accept,type:"file",onChange:m,onClick:d[0]||(d[0]=B(()=>{},["stop"]))},null,42,kt)],42,Et))}});var re=z($t,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const ue="ElUpload",ie=a=>{var r;(r=a.url)!=null&&r.startsWith("blob:")&&URL.revokeObjectURL(a.url)},Rt=(a,r)=>{const e=Be(a,"fileList",void 0,{passive:!0}),u=n=>e.value.find(o=>o.uid===n.uid);function c(n){var o;(o=r.value)==null||o.abort(n)}function v(n=["ready","uploading","success","fail"]){e.value=e.value.filter(o=>!n.includes(o.status))}const f=(n,o)=>{const i=u(o);!i||(console.error(n),i.status="fail",e.value.splice(e.value.indexOf(i),1),a.onError(n,i,e.value),a.onChange(i,e.value))},k=(n,o)=>{const i=u(o);!i||(a.onProgress(n,i,e.value),i.status="uploading",i.percentage=Math.round(n.percent))},b=(n,o)=>{const i=u(o);!i||(i.status="success",i.response=n,a.onSuccess(n,i,e.value),a.onChange(i,e.value))},p=n=>{ce(n.uid)&&(n.uid=Q());const o={name:n.name,percentage:0,status:"ready",size:n.size,raw:n,uid:n.uid};if(a.listType==="picture-card"||a.listType==="picture")try{o.url=URL.createObjectURL(n)}catch(i){Ae(ue,i.message),a.onError(i,o,e.value)}e.value=[...e.value,o],a.onChange(o,e.value)},_=async n=>{const o=n instanceof File?u(n):n;o||x(ue,"file to be removed not found");const i=s=>{c(s);const d=e.value;d.splice(d.indexOf(s),1),a.onRemove(s,d),ie(s)};a.beforeRemove?await a.beforeRemove(o,e.value)!==!1&&i(o):i(o)};function m(){e.value.filter(({status:n})=>n==="ready").forEach(({raw:n})=>{var o;return n&&((o=r.value)==null?void 0:o.upload(n))})}return te(()=>a.listType,n=>{n!=="picture-card"&&n!=="picture"||(e.value=e.value.map(o=>{const{raw:i,url:s}=o;if(!s&&i)try{o.url=URL.createObjectURL(i)}catch(d){a.onError(d,o,e.value)}return o}))}),te(e,n=>{for(const o of n)o.uid||(o.uid=Q()),o.status||(o.status="success")},{immediate:!0,deep:!0}),{uploadFiles:e,abort:c,clearFiles:v,handleError:f,handleProgress:k,handleStart:p,handleSuccess:b,handleRemove:_,submit:m,revokeFileObjectURL:ie}},St=L({name:"ElUpload"}),wt=L({...St,props:at,setup(a,{expose:r}){const e=a,u=H(),c=Z(),{abort:v,submit:f,clearFiles:k,uploadFiles:b,handleStart:p,handleError:_,handleRemove:m,handleSuccess:n,handleProgress:o,revokeFileObjectURL:i}=Rt(e,c),s=j(()=>e.listType==="picture-card"),d=j(()=>({...e,fileList:b.value,onStart:p,onProgress:o,onSuccess:n,onError:_,onRemove:m}));return Me(()=>{b.value.forEach(i)}),Ne(ve,{accept:Ie(e,"accept")}),r({abort:v,submit:f,clearFiles:k,handleStart:p,handleRemove:m}),(l,w)=>(y(),C("div",null,[t(s)&&l.showFileList?(y(),P(le,{key:0,disabled:t(u),"list-type":l.listType,files:t(b),"handle-preview":l.onPreview,onRemove:t(m)},se({append:$(()=>[R(re,ae({ref_key:"uploadRef",ref:c},t(d)),{default:$(()=>[l.$slots.trigger?S(l.$slots,"trigger",{key:0}):E("v-if",!0),!l.$slots.trigger&&l.$slots.default?S(l.$slots,"default",{key:1}):E("v-if",!0)]),_:3},16)]),_:2},[l.$slots.file?{name:"default",fn:$(({file:U})=>[S(l.$slots,"file",{file:U})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):E("v-if",!0),!t(s)||t(s)&&!l.showFileList?(y(),P(re,ae({key:1,ref_key:"uploadRef",ref:c},t(d)),{default:$(()=>[l.$slots.trigger?S(l.$slots,"trigger",{key:0}):E("v-if",!0),!l.$slots.trigger&&l.$slots.default?S(l.$slots,"default",{key:1}):E("v-if",!0)]),_:3},16)):E("v-if",!0),l.$slots.trigger?S(l.$slots,"default",{key:2}):E("v-if",!0),S(l.$slots,"tip"),!t(s)&&l.showFileList?(y(),P(le,{key:3,disabled:t(u),"list-type":l.listType,files:t(b),"handle-preview":l.onPreview,onRemove:t(m)},se({_:2},[l.$slots.file?{name:"default",fn:$(({file:U})=>[S(l.$slots,"file",{file:U})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):E("v-if",!0)]))}});var Ct=z(wt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const Ut=qe(Ct);const Lt=a=>(Ke("data-v-4bdfd0da"),a=a(),Ve(),a),Pt={class:"upload-container"},Ot=Lt(()=>O("div",{class:"el-upload__text"},[Xe(" \u5C06\u56FE\u7247\u62D6\u5165\u6216 "),O("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1)),Tt={class:"el-upload__tip"},Dt=L({__name:"index",props:{url:{default:""},fileList:{default:()=>[]},params:{default:()=>({})},disabled:{type:Boolean,default:!1},tips:{default:"\u4E0A\u4F20\u56FE\u7247"}},emits:["beforeUpload","onSuccess","onError","onRemove"],setup(a,{emit:r}){const e=a,u=j(()=>e.params),c=j(()=>{const o=[];return Object.keys(u.value).length&&Object.keys(u.value).forEach(i=>{u.value[i]!==void 0&&u.value[i]!==null&&o.push(i+"="+u.value[i])}),console.log("%c upload image params(UploadImgSingle Tips): =>","color: #00aadf",o.length?o.join("&"):""),o.length?o.join("&"):""}),v=j(()=>"https://www.fastmock.site/mock/2b34a823b8b83582c5da93412b0ca649/api"+e.url+"?"+c.value),f=j(()=>({Authorization:`${ze()}`})),k=o=>{const i=o.substring(o.lastIndexOf(".")+1),s=i==="jpg",d=i==="png",l=i==="jpeg";return!s&&!d&&!l?!1:s||d||l},b=o=>{if(r("beforeUpload",o),!k(o.name))return q.warning("\u4E0A\u4F20\u6587\u4EF6\u53EA\u80FD\u662F jpg, jpeg, png\u683C\u5F0F!"),!1},p=(o,i)=>{k(o.source1)?(q.success("\u4E0A\u4F20\u6210\u529F"),r("onSuccess",!0)):(q.error("\u4E0A\u4F20\u5931\u8D25"),r("onError",i))},_=o=>{r("onError",o)},m=()=>{r("onRemove")},n=()=>{q.warning("\u53EA\u80FD\u4E0A\u4F20\u4E00\u5F20\u56FE\u7247")};return(o,i)=>{const s=T,d=Ut;return y(),C("div",Pt,[R(d,{action:v.value,headers:f.value,multiple:!1,limit:1,"before-upload":b,"on-success":p,"on-error":_,"on-remove":m,"file-list":e.fileList,"on-exceed":n,disabled:e.disabled,drag:"","show-file-list":"","auto-upload":"",class:"image-upload"},{tip:$(()=>[O("div",Tt,J(e.tips),1)]),default:$(()=>[R(s,{class:"el-icon--upload"},{default:$(()=>[R(t(He))]),_:1}),Ot]),_:1},8,["action","headers","file-list","disabled"])])}}});const jt=me(Dt,[["__scopeId","data-v-4bdfd0da"]]),Bt={class:"container"},At=L({__name:"upload",setup(a){const r=()=>{console.log("handleUploadSuccess")};return(e,u)=>(y(),C("div",Bt,[R(jt,{url:"/api/v1/upload",params:{id:"params"},disabled:!1,tips:"\u8BF7\u9009\u62E9\u56FE\u7247\u4E0A\u4F20\uFF0C\u56FE\u7247\u5927\u5C0F\u8BF7\u5C0F\u4E8E10M",onOnSuccess:r})]))}});const Ht=me(At,[["__scopeId","data-v-bb131ad3"]]);export{Ht as default};
